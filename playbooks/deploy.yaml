- hosts: all
  gather_facts: False
  tasks:
    - name: fetch app repo
      git:
        repo=https://github.com/dolph/pasteraw.git
        dest=/var/www/pasteraw

- hosts: all
  gather_facts: False
  sudo: True
  sudo_user: pasteraw
  tasks:
    - name: install app
      pip:
        name=/var/www/pasteraw
        state=latest
        virtualenv=~/venv

- hosts: all
  gather_facts: False
  tasks:
    - name: restart supervised processes
      supervisorctl:
        name={{ item }}
        state=restarted
      with_items:
        - gunicorn
